<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>2.2.2.1</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
	Hello
</body>

<script type="text/javascript">

const twitch_api = 'https://api.twitch.tv/v5/'


function saveText(text, filename){
  var a = document.createElement('a');
  a.setAttribute('href', 'data:text/plain;charset=utf-u,'+encodeURIComponent(text));
  a.setAttribute('download', filename);
  a.click()
}

const fetchCommentsBlocks = async (videoId, cursor) => {
	let video = {
		"comments": []
	}
	let params = {
  		"client_id": "lilafa2xzc63rj3vgpjhq312hjoax9",
	}
	while (cursor != undefined) {
		if (cursor != '') {
			params["cursor"] = cursor
		}

		let query = Object.keys(params)
	             .map(k => encodeURIComponent(k) + '=' + encodeURIComponent(params[k]))
	             .join('&');

		const response = await fetch(`${twitch_api}videos/${videoId}/comments?` + query);
		const commentsBlock = await response.json(); //extract JSON from the http response
		// video["comments"] += commentsBlock["comments"];
		for (let comment in commentsBlock["comments"]) {
			video["comments"].push(commentsBlock["comments"][comment]);
		}

		console.log(commentsBlock);
		cursor = commentsBlock["_next"];
	}
	return video;
}

const fetchComments = async (videoId, cursor) => {
	let video = await fetchCommentsBlocks(videoId, cursor);
	console.log(JSON.stringify(video, null, 2));
	saveText( JSON.stringify(video), "video.json" );
}

fetchComments("390009729","");





</script>
</html>